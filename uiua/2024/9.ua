P₁ ← (
  ⨬÷₂∞⊸◿₂▽:°⊏
  ⍜▽◌⊸=∞:⇌▽⊸≠∞:⊃↙↘/+≠∞.
  /+×°⊏
)

P₂ ← (
  °□₂⊕□◿₂°⊏
  ⊃⊙∘⊸⍚△ # array of boxed empty arrays
  ∩⇌°⊏
  ∧(
    ◡<⊙◡(⬚∞⊢⊚≥)                          # check moveable
    ⨬(:⍜⊡⍜°□(⊂:)⟜:⊙⋅⋅:                   # can't move
    | ⊃(⍜⊡+-1⊙⊸⍜⊡(-:)⊙⊙:|⍜⊡⍜°□⊂⊙::⊙⊙⋅⋅∘) # can move
    )
  )
  ⊙⍚(/◇⊂⍚↯:⟜⊏)⊙⊙¤
  /◇⊂⍚(⊂:⊚)⊂:0
  /+×°⊏
)

Solve ← ⊃P₂P₁ -@0▽⊸≠@\n

